@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Daily Balance Verification Report</title>
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />
    <script src="~/Scripts/jquery-2.1.3.min.js"></script>
    <script src="~/Scripts/bootstrap.min.js"></script>
    <style>
        body {
            margin:15px 15px 0 15px;
        }
        .section-header {
            background-color: #eee;
            margin-bottom: 15px;
        }

        .section-header-text {
            padding-top: 5px;
            padding-bottom: 5px;
            color: #000;
            letter-spacing: 1px;
        }
    </style>
</head>
<body>
    <div class="container"> 
        <div class="col-md-12 section-header">
            <img src="~/Content/Images/maxxam.png" />
            <h4 class="pull-right section-header-text">Daily Balance Verification Report: Organics</h4>
        </div>
        <div class="container">

            <table id="device-table" class="table table-striped table-bordered table-hover">
                <thead>
                    <tr>
                        <td>Device Code</td>
                        <td>Department</td>
                        <td>Number of Tests to Verify</td>
                        <td>Verified By</td>
                    </tr>
                </thead>
                <tbody></tbody>
                <tfoot>
                    <tr>
                        <td>Device Code</td>
                        <td>Department</td>
                        <td>Number of Tests to Verify</td>
                        <td>Verified By</td>
                    </tr>
                </tfoot>
            </table>
        </div>

        <div class="col-md-12 section-header">
             <h4 class="section-header-text">Report Requested By: @ViewBag.User | Requested on: <span id="date-today"></span></h4>
        </div>
    </div>
    <script>
        $(function () {
            var json;

            function onDataReceived(data) {
                json = data;
            }

            //ajax call
            var getAjaxData = $.ajax({
                type: "GET",
                url: "http://localhost:1413/api/reportsdevicesapi",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: onDataReceived,
                error:
                    function (xhr, status, error) {
                        console.log("error");
                    }
            });

            $.when(getAjaxData).done(function (x) {
                var table = $("#device-table tbody");
                var text;

                $.each(json, function (i, row) {
                    console.log(row);
                    var zero = row.DeviceVerifications.length == 0 ? "Not Verified Today" : row.DeviceVerifications.length;
                    text += "<tr>" +
                                "<td>" + row.DeviceCode + "</td>" +
                                "<td>" + row.Department.SubDepartment + "</td>" +
                                "<td>" + zero + "</td>" +
                                "<td>" + row.LastVerifiedBy + "</td>" +
                            "</tr>";
                });
                table.append(text);
            });

            var date = new Date();
            document.getElementById('date-today').innerHTML = date.getFullYear() + "-" + (date.getMonth() + 1) + "-" + date.getDate();
        });
    </script>
</body>
</html>
