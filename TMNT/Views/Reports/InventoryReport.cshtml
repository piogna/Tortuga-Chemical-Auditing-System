
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Inventory Report</title>
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />
    <script src="~/Scripts/jquery-2.1.3.min.js"></script>
    <script src="~/Scripts/bootstrap.min.js"></script>
    <style>
        body {
            margin: 15px 15px 0 15px;
        }

        .section-header {
            background-color: #eee;
            margin-bottom: 15px;
        }

        .section-header-text {
            padding-top: 5px;
            padding-bottom: 5px;
            color: #000;
            letter-spacing: 1px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="col-md-12 section-header">
            <img src="~/Content/Images/maxxam.png" />
            <h4 class="pull-right section-header-text">Monthly Chemical Report: Organics</h4>
        </div>
        <div class="container">

            <table id="chemical-table" class="table table-striped table-bordered table-hover">
                <thead>
                    <tr>
                        <td>Chemical Type</td>
                        <td>Expiry Date</td>
                        <td>Lot Number</td>
                        <td>Usage Count</td>
                    </tr>
                </thead>
                <tbody></tbody>
                <tfoot>
                    <tr>
                        <td>Chemical Type</td>
                        <td>Expiry Date</td>
                        <td>Lot Number</td>
                        <td>Usage Count</td>
                    </tr>
                </tfoot>
            </table>
        </div>

        <div class="col-md-12 section-header">
            <h4 class="section-header-text">Report Requested By: @ViewBag.User | Requested on: <span id="date-today"></span></h4>
        </div>
    </div>
    <script>
        $(function () {
            var json;

            function onDataReceived(data) {
                json = data;
            }

            //ajax call
            var getAjaxData = $.ajax({
                type: "GET",
                url: "http://localhost:1413/api/expiringitems",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: onDataReceived,
                error:
                    function (xhr, status, error) {
                        console.log("error");
                    }
            });

            $.when(getAjaxData).done(function (x) {
                var table = $("#chemical-table tbody"), text = "";

                $.each(json, function (i, row) {
                    var expiryDate = new Date(row.StockReagent.ExpiryDate),
                        dayFormat = expiryDate.getFullYear() + "-" + (expiryDate.getMonth() + 1) + "-" + expiryDate.getDate();
                    text += "<tr><td>" + row.ChemicalType + "</td>";

                    switch (row.ChemicalType) {
                        case "Reagent":
                            text += "<td>" + dayFormat + "</td>" +
                            "<td>" + row.StockReagent.LotNumber + "</td>"
                            break;
                        case "Standard":
                            text += "<td>" + dayFormat + "</td>" +
                            "<td>" + row.StockStandard.LotNumber + "</td>"
                            break;
                        case "Intermediate Standard":
                            text += "<td>" + dayFormat + "</td>" +
                            "<td>" + row.IntermediateStnadard.IdCode + "</td>"
                            break;
                        case "Working Standard":
                            text += "<td>" + dayFormat + "</td>" +
                            "<td>" + row.WorkingStandard.IdCode + "</td>"
                            break;
                        default:
                            alert("error reading in expiring chemicals");
                            break;
                    }

                    if (row.UsageCount <= 20) {
                        text += "<td>Low Importance</td>";
                    } else if (row.UsageCount <= 30) {
                        text += "<td>Medium Importance</td>";
                    } else {
                        text += "<td>High Importance</td>";
                    }
                    text += "</tr>";
                });
                table.append(text);
            });

            var date = new Date();
            document.getElementById('date-today').innerHTML = date.getFullYear() + "-" + (date.getMonth() + 1) + "-" + date.getDate();
        });
    </script>
</body>
</html>
